<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="apple-touch-icon" sizes="180x180" href="imagenes/logo.png">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Ruta Escape Europa</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="estilos.css">
  
  <!-- Firebase SDKs primero -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-messaging-compat.js" defer></script>

  <!-- Tu JS principal que usa Firebase, al final para que Firebase est√© cargado -->
  <script src="notificaciones.js" defer></script>
  <style>
    :root {
      --color-primario: #2E294E;
      --color-secundario: #1B998B;
      --color-texto: #FFFFFF;
      --color-acento: #6EC2E8;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--color-primario);
      color: var(--color-texto);
      padding: 1.5rem;
    }

    h1 {
      color: var(--color-acento);
      text-align: center;
    }

    .dia {
      margin: 2rem 0;
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 1rem;
      box-shadow: 0 0 10px rgba(110, 194, 232, 0.3);
    }

    .juego h3 {
      color: var(--color-secundario);
    }

    img {
      width: 100%;
      max-width: 400px;
      border-radius: 0.5rem;
      margin-top: 0.5rem;
    }

    button {
      margin-top: 1rem;
      display: block;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      background-color: var(--color-acento);
      color: var(--color-primario);
      border: none;
      border-radius: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #94d6f5;
    }

    .info-extra {
      display: none;
      margin-top: 1rem;
      background-color: rgba(255, 255, 255, 0.08);
      padding: 1rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>‚≠ê‚Äã Ruta Europea 2025 ‚≠ê‚Äã</h1>

  <section class="dia">
    <h2>üìå Jueves 28 de agosto ‚Äì Portugal</h2>
    <article class="juego">
      <h3>Dream</h3>
      <p><strong>Hora:</strong> 11:00</p></a>
      <p><strong>Lugar:</strong> Lisboa</p>
      <button onclick="mostrarInfo(this)">M√°s informaci√≥n</button>
      <div class="info-extra">
        <p><strong>Historia:</strong> Viniste a alojarte en el Escape Hotel y te encontraste dentro de un sue√±o. ¬øPodr√°s escapar de ello?‚Äã</p>
        <p><strong>Direcci√≥n completa:</strong><a href="https://maps.app.goo.gl/f4CS7cpqzi9mJn9W6" style="color: inherit; text-decoration: none;"> Rua Ernesto da Silva 54 Loja A Alg√©s, Oeiras (Enlace a Google Maps)</a></p>
      </div>
    </article>
  </section>

  <section class="dia">
    <h2>3 de agosto ‚Äì Praga</h2>
    <article class="juego">
      <h3>Mindfall</h3>
      <p><strong>Hora:</strong> 17:30</p>
      <p><strong>Lugar:</strong> Karlovo n√°mƒõst√≠ 10, Praga</p>
      <img src="imagenes/juego2.jpg" alt="Confirmaci√≥n de reserva">
      <button onclick="mostrarInfo(this)">M√°s informaci√≥n</button>
      <div class="info-extra">
        <p><strong>Historia:</strong> Un virus mental ha sido liberado. Como agentes secretos, tu equipo debe detener una cat√°strofe global.</p>
        <p><strong>Direcci√≥n completa:</strong> Karlovo n√°mƒõst√≠ 10, 120 00 Nov√© Mƒõsto, Praga</p>
      </div>
    </article>
  </section>

  <button id="btnNotificaciones">üîî Activar notificaciones</button>

  <script>

    document.getElementById('btnNotificaciones').addEventListener('click', solicitarPermiso);

    function mostrarInfo(boton) {
      const info = boton.nextElementSibling;
      info.style.display = (info.style.display === "block") ? "none" : "block";
    }
  // Registrar el Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('firebase-service-worker.js')
      .then(() => console.log('‚úÖ Service Worker registrado'))
      .catch(err => console.error('‚ùå Error al registrar el SW:', err));
  }

  // Pedir permiso y programar notificaciones
  function solicitarPermiso() {
  // Primero pides permiso y programa tus notificaciones locales
  Notification.requestPermission().then(permiso => {
    if (permiso === 'granted') {
      localStorage.setItem('notificaciones_activadas', 'true');
      programarNotificaciones();

      // Ahora pides permiso y token para Firebase Messaging
      pedirPermisoFirebase();
    }
  });
}

  function programarNotificaciones() {
    const juegos = [
      { titulo: "Escape del Faro", fecha: "2025-07-05", hora: "16:00" },
      { titulo: "Misterio G√≥tico", fecha: "2025-07-06", hora: "18:30" },
      { titulo: "Laboratorio Mutante", fecha: "2025-07-07", hora: "12:00" }
      // a√±ade los tuyos aqu√≠...
    ];

    const ahora = new Date();

    juegos.forEach(juego => {
      if (!juego.fecha || !juego.hora) return;

      const juegoHora = new Date(`${juego.fecha}T${juego.hora}:00`);
      const notiHora = new Date(juegoHora.getTime() - 60 * 60 * 1000);
      const tiempoRestante = notiHora.getTime() - ahora.getTime();

      if (tiempoRestante > 0 && tiempoRestante < 10 * 24 * 60 * 60 * 1000) {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            titulo: juego.titulo,
            fecha: juego.fecha,
            hora: juego.hora
          });
        }
      }
    });
  }

  // Ejecutar autom√°ticamente si el usuario ya hab√≠a dado permiso
  if (Notification.permission === 'granted' &&
      localStorage.getItem('notificaciones_activadas') === 'true') {
    programarNotificaciones();
  }
</script>
</body>
</html>